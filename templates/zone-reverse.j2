{#
    The following variables are available:

    - nameservers   (list of dns.name.Name, nameservers)
    - addresses     (list of IP Address, address records)
    - origin        (dns.name.Name, zone origin)
    - reverse_origin    (dns.name.Name, reverse zone origin)
    - serial        (zone serial)
    - refresh       (zone refresh)
    - retry         (zone retry)
    - expire        (zone expire)
    - ttl           (zone TTL)
    - timestamp
#}
{%- macro get_name(ip_address) -%}
{%- if ip_address.dns_name -%}
{{ ip_address.dns_name | fqdn }} {#- FIXME we just assume that 'dns_name' is qualified -#}
{%- else -%}
{%- if ip_address.assigned_object.device -%}
{{ ip_address.assigned_object.device.name | fqdn(origin) }}
{%- elif ip_address.assigned_object.virtual_machine -%}
{{ ip_address.assigned_object.virtual_machine.name | fqdn(origin) }}
{%- endif -%}
{%- endif -%}
{%- endmacro -%}

;; Do not edit manually!
;; This file was generated by netbox-dns-zone at: {{ timestamp }}

$ORIGIN {{ reverse_origin }}
$TTL {{ ttl }}
{{ "%-39s" | format(reverse_origin | relativize) }} IN  SOA     {{ origin }} {{ "root" | fqdn(origin) }} {{ serial }} {{ refresh }} {{ retry }} {{ expire }} {{ ttl }}
{{ "%-39s" | format(reverse_origin | relativize) }} IN  TXT     "generated-by=netbox-dns-zone"
{{ "%-39s" | format(reverse_origin | relativize) }} IN  TXT     "generated-at={{ timestamp }}"

{%- for nameserver in nameservers %}
{{ "%-39s" | format(reverse_origin | relativize) }} IN  NS      {{ nameserver | fqdn }}
{%- endfor %}

{%- for ip_address in addresses %}
{{ "%-39s" | format(ip_address | address | reverse_name | relativize ) }} IN  PTR     {{ get_name(ip_address) }}
{%- endfor %}

{% for include in includes %}
;; BEGIN included file: {{ include.name }}
{{ include.read() -}}
;; END included file: {{ include.name }}
{% endfor %}
